<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a>asterisk-ami (v0.1.0)</a>
</h1>
<h4>An asterisk ami connector</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.asterisk-ami">module asterisk-ami</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.asterisk-ami">
            function <span class="apidocSignatureSpan"></span>asterisk-ami
            <span class="apidocSignatureSpan">(params)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi">
            function <span class="apidocSignatureSpan">asterisk-ami.</span>AsteriskAmi
            <span class="apidocSignatureSpan">(params)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.super_">
            function <span class="apidocSignatureSpan">asterisk-ami.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">asterisk-ami.</span>AsteriskAmi.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.asterisk-ami.AsteriskAmi">module asterisk-ami.AsteriskAmi</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.AsteriskAmi">
            function <span class="apidocSignatureSpan">asterisk-ami.</span>AsteriskAmi
            <span class="apidocSignatureSpan">(params)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.super_">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.</span>super_
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.asterisk-ami.AsteriskAmi.prototype">module asterisk-ami.AsteriskAmi.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.connect">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>connect
            <span class="apidocSignatureSpan">(connect_cb, data_cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.debug">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>debug
            <span class="apidocSignatureSpan">(data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.destroy">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>destroy
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.disconnect">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>disconnect
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.generateRandom">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>generateRandom
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.generateSocketData">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>generateSocketData
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.processData">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>processData
            <span class="apidocSignatureSpan">(data, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.send">
            function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>send
            <span class="apidocSignatureSpan">(obj, cb)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.asterisk-ami" id="apidoc.module.asterisk-ami">module asterisk-ami</a></h1>


    <h2>
        <a href="#apidoc.element.asterisk-ami.asterisk-ami" id="apidoc.element.asterisk-ami.asterisk-ami">
        function <span class="apidocSignatureSpan"></span>asterisk-ami
        <span class="apidocSignatureSpan">(params)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AsteriskAmi(params){
  params = params || {};

  this.net = net;

  this.CRLF = "\r\n";
  this.END = "\r\n\r\n";
  this.buffer = "";

  this.port = params.port || 5038;
  this.host = params.host || 'localhost';
  this.username = params.username || 'username';
  this.password = params.password || 'password';
  this.enable_debug = params.debug || false;
  this.reconnect = params.reconnect || false;
  this.reconnect_after = params.reconnect_after || 3000;
  this.events = (params.events != undefined ? params.events : true);
  this.identifier = params.identifier || false;
  this.ami_encoding = params.ami_encoding || 'ascii';
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi" id="apidoc.element.asterisk-ami.AsteriskAmi">
        function <span class="apidocSignatureSpan">asterisk-ami.</span>AsteriskAmi
        <span class="apidocSignatureSpan">(params)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AsteriskAmi(params){
  params = params || {};

  this.net = net;

  this.CRLF = "\r\n";
  this.END = "\r\n\r\n";
  this.buffer = "";

  this.port = params.port || 5038;
  this.host = params.host || 'localhost';
  this.username = params.username || 'username';
  this.password = params.password || 'password';
  this.enable_debug = params.debug || false;
  this.reconnect = params.reconnect || false;
  this.reconnect_after = params.reconnect_after || 3000;
  this.events = (params.events != undefined ? params.events : true);
  this.identifier = params.identifier || false;
  this.ami_encoding = params.ami_encoding || 'ascii';
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.super_" id="apidoc.element.asterisk-ami.super_">
        function <span class="apidocSignatureSpan">asterisk-ami.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.asterisk-ami.AsteriskAmi" id="apidoc.module.asterisk-ami.AsteriskAmi">module asterisk-ami.AsteriskAmi</a></h1>


    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.AsteriskAmi" id="apidoc.element.asterisk-ami.AsteriskAmi.AsteriskAmi">
        function <span class="apidocSignatureSpan">asterisk-ami.</span>AsteriskAmi
        <span class="apidocSignatureSpan">(params)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AsteriskAmi(params){
  params = params || {};

  this.net = net;

  this.CRLF = "\r\n";
  this.END = "\r\n\r\n";
  this.buffer = "";

  this.port = params.port || 5038;
  this.host = params.host || 'localhost';
  this.username = params.username || 'username';
  this.password = params.password || 'password';
  this.enable_debug = params.debug || false;
  this.reconnect = params.reconnect || false;
  this.reconnect_after = params.reconnect_after || 3000;
  this.events = (params.events != undefined ? params.events : true);
  this.identifier = params.identifier || false;
  this.ami_encoding = params.ami_encoding || 'ascii';
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.super_" id="apidoc.element.asterisk-ami.AsteriskAmi.super_">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.</span>super_
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.asterisk-ami.AsteriskAmi.prototype" id="apidoc.module.asterisk-ami.AsteriskAmi.prototype">module asterisk-ami.AsteriskAmi.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.connect" id="apidoc.element.asterisk-ami.AsteriskAmi.prototype.connect">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>connect
        <span class="apidocSignatureSpan">(connect_cb, data_cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">connect = function (connect_cb, data_cb){
  var self = this;
  self.debug('running ami connect');
  self.socket = null;
  self.socket = this.net.createConnection(this.port, this.host);//reopen it
  self.socket.setEncoding(this.ami_encoding);
  self.socket.setKeepAlive(true, 500);

  self.socket.on('connect', function(){
    self.debug('connected to Asterisk AMI');
    //login to the manager interface
    self.send({Action: 'login', Username : self.username, Secret : self.password, Events: (self.events ? 'on' : 'off')});
    if(connect_cb &amp;&amp; typeof connect_cb == 'function'){
      connect_cb();
    }
  }).on('data', function(data){
    if(data_cb &amp;&amp; typeof data_cb == 'function'){
      data_cb(data);
    }
    var all_events = self.processData(data);
    for(var i in all_events){
      var result = all_events[i];
      if(result.response &amp;&amp; result.message &amp;&amp; /Authentication/gi.exec(result.message) == 'Authentication'){
        self.emit('ami_login', ((result.response == 'Success') ? true : false) ,result);
      }
      self.emit('ami_data', result);
    }
  }).on('drain', function(){
    self.debug('Asterisk Socket connection drained');
    self.emit('ami_socket_drain');
  }).on('error', function(error){
    if(error){
      self.debug('Asterisk Socket connection error, error was: ' + error);//prob lost connection to ami due to asterisk restarting
 so restart the connection
    }
    self.emit('ami_socket_error', error);
  }).on('timeout',function(){
    self.debug('Asterisk Socket connection has timed out');
    self.emit('ami_socket_timeout');
  }).on('end', function() {
    self.debug('Asterisk Socket connection ran end event');
    self.emit('ami_socket_end');
  }).on('close', function(had_error){
    self.debug('Asterisk Socket connection closed, error status - ' + had_error);
    self.emit('ami_socket_close', had_error);
    if(self.reconnect){
      self.debug('Reconnecting to AMI in ' + self.reconnect_after);
      setTimeout(function() {
        self.connect(connect_cb, data_cb);
      }, self.reconnect_after);
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var ami = new AsteriskAmi( { host: 'hostname', username: 'username', password: 'secret' } );

ami.on('ami_data', function(data){
	console.log('AMI DATA', data);
	//decide between Events and non events here and what to do with them, maybe run an event emitter for the ones you care about
});

ami.<span class="apidocCodeKeywordSpan">connect</span>(function(){
	ami.send({action: 'Ping'});//run a callback event when we have connected to the socket
});//connect creates a socket connection and sends the login action

ami.send({action: 'Ping'});
```

##Events
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.debug" id="apidoc.element.asterisk-ami.AsteriskAmi.prototype.debug">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>debug
        <span class="apidocSignatureSpan">(data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">debug = function (data){
  if(this.enable_debug){
    console.log(data);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.destroy" id="apidoc.element.asterisk-ami.AsteriskAmi.prototype.destroy">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>destroy
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">destroy = function (){
  this.socket.destroy();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  console.log('every time data comes back in the socket, this callback is called, useful for recording stats on data',
raw_data);
})

.disconnect() //logs out of the AMI and then closes the connection, sets reconnect to false so that it wont try and reconnect

.send({action: 'Ping'}) //send an ami call, pass in a javascript object with the params you want to send the ami

.<span class="apidocCodeKeywordSpan">destroy</span>() //terminates the connection to the ami socket if say disconnect fails, or
you've lost connection to the ami and you're not using reconnect: true as a param

```


## Configuration options

AsteriskAmi has preset/configurable options, you can set these via an object passed in to AsteriskAmi
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.disconnect" id="apidoc.element.asterisk-ami.AsteriskAmi.prototype.disconnect">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>disconnect
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disconnect = function (){
  this.reconnect = false;//just in case we wanted it to reconnect before, we've asked for it to be closed this time so make sure
 it doesnt reconnect
  this.socket.end(this.generateSocketData({Action: 'Logoff'}));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
```js
.connect(function(){
  console.log('connection to AMI socket successful');
}, function(raw_data){
  console.log('every time data comes back in the socket, this callback is called, useful for recording stats on data',
raw_data);
})

.<span class="apidocCodeKeywordSpan">disconnect</span>() //logs out of the AMI and then closes the connection, sets reconnect to
 false so that it wont try and reconnect

.send({action: 'Ping'}) //send an ami call, pass in a javascript object with the params you want to send the ami

.destroy() //terminates the connection to the ami socket if say disconnect fails, or you've lost connection to the ami and
you're not using reconnect: true as a param

```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.generateRandom" id="apidoc.element.asterisk-ami.AsteriskAmi.prototype.generateRandom">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>generateRandom
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generateRandom = function (){
  return Math.floor(Math.random()*100000000000000000);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.generateSocketData" id="apidoc.element.asterisk-ami.AsteriskAmi.prototype.generateSocketData">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>generateSocketData
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">generateSocketData = function (obj){
  var str = '';
  for(var i in obj){
    str += (i + ': ' + obj[i] + this.CRLF);
  }
  return str + this.CRLF;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.processData" id="apidoc.element.asterisk-ami.AsteriskAmi.prototype.processData">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>processData
        <span class="apidocSignatureSpan">(data, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">processData = function (data, cb){
<span class="apidocCodeCommentSpan">  /*
  Thanks to mscdex for this bit of code that takes many lots of data and sorts them out into one if needed!
  https://github.com/mscdex/node-asterisk/blob/master/asterisk.js
  */
</span>  data = data.toString();
  if (data.substr(0, 21) == "Asterisk Call Manager"){
    data = data.substr(data.indexOf(this.CRLF)+2); // skip the server greeting when first connecting
  }
  this.buffer += data;
  var iDelim, info, headers, kv, type, all_events = [];
  while ((iDelim = this.buffer.indexOf(this.END)) &gt; -1) {
    info = this.buffer.substring(0, iDelim+2).split(this.CRLF);
    this.buffer = this.buffer.substr(iDelim + 4);
    result = {}; type = ""; kv = [];
    for (var i=0,len=info.length; i&lt;len; i++) {
      if (info[i].indexOf(": ") == -1){
        continue;
      }
      kv = info[i].split(": ", 2);
      kv[0] = kv[0].toLowerCase().replace("-", "");
      if (i==0){
        type = kv[0];
      }
      result[kv[0]] = kv[1];
    }
    if(this.identifier){
      result.identifier = this.identifier;
    }
    all_events.push(result);
  }
  return all_events;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.asterisk-ami.AsteriskAmi.prototype.send" id="apidoc.element.asterisk-ami.AsteriskAmi.prototype.send">
        function <span class="apidocSignatureSpan">asterisk-ami.AsteriskAmi.prototype.</span>send
        <span class="apidocSignatureSpan">(obj, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">send = function (obj, cb) {
  //check state of connection here, if not up then bail out
  if(!obj.ActionID){
      obj.ActionID = this.generateRandom();
  }

  //maybe i should be checking if this socket is writeable
  if(this.socket != null &amp;&amp; this.socket.writable){
    this.debug(obj);
    this.socket.write(this.generateSocketData(obj), this.ami_encoding, cb);
  }else{
    this.debug('cannot write to Asterisk Socket');
    this.emit('ami_socket_unwritable');
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

ami.on('ami_data', function(data){
	console.log('AMI DATA', data);
	//decide between Events and non events here and what to do with them, maybe run an event emitter for the ones you care about
});

ami.connect(function(){
	ami.<span class="apidocCodeKeywordSpan">send</span>({action: 'Ping'});//run a callback event when we have connected to
 the socket
});//connect creates a socket connection and sends the login action

ami.send({action: 'Ping'});
```

##Events
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>